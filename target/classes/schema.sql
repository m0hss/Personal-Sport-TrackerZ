-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public."user"
(
    id SERIAL,
    fname varchar(25) NOT NULL,
    lname varchar(25) NOT NULL,
    email varchar(25) NOT NULL,
    age integer NOT NULL,
    role varchar(5) NOT NULL CHECK (role IN ('COACH', 'USER')),
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.course
(
	id SERIAL,
    name varchar(25) NOT NULL,
    localisation varchar(100) NOT NULL,
    date DATE NOT NULL,
    type varchar(5) NOT NULL CHECK (type IN ('IN', 'OUT')),
    available boolean DEFAULT false,
    places integer,
    coach integer,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.users_courses
(
    userid integer NOT NULL,
    courseid integer NOT NULL,
    PRIMARY KEY (userid, courseid)
);

ALTER TABLE IF EXISTS public.course
    ADD CONSTRAINT coach FOREIGN KEY (coach)
    REFERENCES public.user (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.users_courses
    ADD CONSTRAINT userid FOREIGN KEY (userid)
    REFERENCES public.user (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.users_courses
    ADD CONSTRAINT courseid FOREIGN KEY (courseid)
    REFERENCES public.course (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;

END;